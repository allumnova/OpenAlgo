services:
  api:
    build:
      context: ./api
      dockerfile: ../docker/Dockerfile.api
    volumes:
      - ./api:/app
      - ./shared:/app/shared
      - ./data:/app/data
    ports:
      - "${API_PORT:-8001}:8000"
    env_file:
      - .env
    depends_on:
      - db

  engine:
    build:
      context: ./engine
      dockerfile: ../docker/Dockerfile.engine
    volumes:
      - ./engine:/app
      - ./shared:/app/shared
      - ./data:/app/data
    env_file:
      - .env
    depends_on:
      - db

  dashboard:
    build:
      context: ./dashboard
      dockerfile: ../docker/Dockerfile.dashboard
    ports:
      - "${DASHBOARD_PORT:-3001}:3000"
    volumes:
      - ./dashboard:/app
      - /app/node_modules
    stdin_open: true

  db:
    image: alpine
    command: ["/bin/sh", "-c", "echo 'Using SQLite in /data volume' && tail -f /dev/null"]
    volumes:
      - ./data:/data

  whatsapp:
    build:
      context: ./whatsapp
      dockerfile: ../docker/Dockerfile.whatsapp
    volumes:
      - ./whatsapp:/app
      - /app/node_modules
      - ./whatsapp/sessions:/app/sessions
    env_file:
      - .env
    depends_on:
      - api
